# Git-Flow について

2022 年 10 月より従来の [GitHub-Flow](https://github.com/fan-ADN/nendSDK-Document-Private/wiki/AboutGitHub-Flow) のブランチモデルによる開発から `Git-Flow` への開発へ試験的移行しました。

## 移行の経緯・理由

GitHub-Flow はメインブランチへ機能ブランチを PR を介して直接マージするというシンプルなブランチモデルである。

- Web ページやサーバーなどリリーススパンが短いプログラムに適している(メインブランチへマージと当時にデプロイされるような仕組みが成り立っている場合は特に)
- SDK チームではシンプルな開発フローであるこちらを採用して開発していた

しかし、 SDK の場合、2022 年 10 月現在のリリーススパンは 2-4 半期に 1 度くらいしかない。

- GitHub-Flow の方が適しているとされる開発フローとは異なってきている
- 実際、 GitHub-Flow による開発運用では次回リリースに含まれる機能内容を忘れてしまうことがしばしばあった

SDK チーム内の MTG や議論の結果、これを Git-Flow に置き換えることで解決できるか試してみることにした。

## GitHub-Flow との違い

- GitHub-Flow には大きく分けてメインブランチとそこから派生される機能ブランチしかない
  - リリース、HotFix な修正もこの機能ブランチに属する
- Git-Flow は用途毎にブランチが分かれており、それらを使い分けることでリリースの準備や保守、記録できることにメリットがある

|             | ブランチの種類                                                                 | メリット                                                                               | デメリット                                                   |
|-------------|--------------------------------------------------------------------------------|----------------------------------------------------------------------------------------|--------------------------------------------------------------|
| GitHub-Flow | メインブランチと機能ブランチのみ                                               | ルールがシンプル                                                                       | 頻繁なリリースを行わないサービス・アプリケーションには不向き |
| Git-Flow    | メインブランチ<br>リリースブランチ<br>開発用ブランチ<br>hotfixブランチ<br>など | 開発用とリリース用でブランチが分かれており、長期間の機能開発でも変更差分が理解しやすい | 用途毎にブランチのルールがあり、比較的やや複雑               |

## Git-Flow ルール (SDKチーム)

SDK チームでは Git-Flow を以下のように運用する。

### 基本的なルール

以下のブランチルールに基づいて開発する。  
`master` 、 `develop` ブランチ以外はブランチ名に prefix ( `feature/` , `hotfix/` , `release/` ) を付けていることが好ましいが、そこに強制力はない。  
以前の GitHub-Flow 同様、 `issueXX_***_***` といった名前の機能ブランチでも問題ない。

### ブランチルール

- `master` ブランチはメインブランチとして使用する
  - 最新のリリース状態を維持する
  - 基本的にこのブランチから派生されることはない
  - リリースブランチとマージ後の `master` はバージョン番号でタグを付ける
- `develop` ブランチは開発用ブランチとして使用する
  - 常に最新を維持する
  - リリース時に `release` ブランチをこのブランチから派生する
- `feature` ブランチは機能ブランチとして使用する
  - `develop` ブランチから派生する
- `release` ブランチはリリース用ブランチとして使用する
  - `develop` ブランチから派生し、リリースに必要な情報をコミットする
    - バージョン番号の更新作業
    - 新しい SDK のパッケージング作業
  - リリース準備時に `master` へ向けて PR を作成し、リリース作業時にマージ

## 参考情報

- ATLASSIAN の Gitflow チュートリアル
  - https://www.atlassian.com/ja/git/tutorials/comparing-workflows/gitflow-workflow
